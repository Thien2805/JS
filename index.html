<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="container mt-3">
    <h3>Staff</h3>


    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">
      Open modal
    </button>
  </div>

  <!-- The Modal -->
  <div class="modal" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Nhân viên</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <h4 id="ten"></h4>
          <p id="dob"></p>
          <p id="ngayvao"></p>
          <p id="phongban"></p>
          <p id="ngaynghi"></p>
          <p id="lamthem"></p>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>
  <main id="main"></main>
  <script>
    // get danh sách nhân viên
    fetch("http://localhost:8081/staffs")
      .then(function (response) {
        return response.json();
      }).then(function (staffs) {
        // code tạo HTML từ danh sách nhân viên ở đây.
        staffs.forEach((element) => {
          let div = document.createElement("div");
          let p = document.createElement("p");
          let image = document.createElement("img")
          document.getElementById("main").append(div);
          div.id = element.id;
          div.append(p);
          div.append(image);
          p.innerHTML = element.name
          image.setAttribute("src", element.image)
          div.onclick = nhanvien;

        });
        function nhanvien(event) {
          staffs.forEach((element) => {
            console.log(element);
            if ("" + element.id === this.id) {
              let name = document.getElementById("ten").innerHTML = "Họ và tên: " + element.name;
              let ngaysinh = new Date(element.doB);
              document.getElementById("dob").innerHTML = "Ngày sinh: " + ngaysinh.toLocaleDateString();
              let ngayvao = new Date(element.startDate);
              document.getElementById("ngayvao").innerHTML = "Ngày vào: " + ngayvao.toLocaleDateString();

              fetch("http://localhost:8081/departments/{id}")
                .then(function (response) {
                  return response.json()
                }).then(function (staffs) {
                  document.getElementById("phongban").innerHTML = "Phòng ban: " + element.departmentId;
                  document.getElementById("ngaynghi").innerHTML = "Số ngày nghỉ còn lại: " + element.annualLeave;
                  document.getElementById("lamthem").innerHTML = "Số ngày đã làm thêm: " + element.overTime;
                })


            }
          })

        }


      })
      //báo lỗi api
      .catch((error) => {
        alert(error);
      });
    // DELETE xóa một nhân viên
    fetch("http://localhost:8081/staffs/18", {
      method: "DELETE",
    }).then((response) => {
      console.log(response);
    });
  </script>
</body>

</html>